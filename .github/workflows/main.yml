name: Deploy to Cloudflare Tunnel

on:
  push:
    branches:
      - main  # Ganti dengan nama branch yang kamu gunakan

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Install Apache2
        run: |
          sudo apt update
          sudo apt install -y apache2
          sudo systemctl start apache2
          sudo systemctl enable apache2

      - name: Set up Cloudflare Tunnel
        env:
          CLOUDFLARE_TOKEN: ${{ secrets.CLOUDFLARE_TOKEN }}
          CERT_PEM: ${{ secrets.CERT_PEM }}  # Sertifikat yang disimpan di secrets
        run: |
          echo "$CERT_PEM" > cert.pem  # Menyimpan sertifikat ke file
          cloudflared tunnel --id 7d92c3d4-daea-488e-bd1f-a78c6c673adf run --url http://localhost:80

      - name: Clean up
        run: |
          sudo systemctl stop apache2
